---
phase: 04-navigation-sealed-hierarchies
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/java/com/mojang/tower/navigation/NavigationGrid.java
  - src/main/java/com/mojang/tower/Island.java
  - src/main/java/com/mojang/tower/movement/MovementSystem.java
  - src/main/java/com/mojang/tower/TowerComponent.java
  - src/main/java/com/mojang/tower/service/ServiceLocator.java
autonomous: true

must_haves:
  truths:
    - "NavigationGrid interface provides abstraction for world queries"
    - "MovementSystem depends on NavigationGrid, not concrete Island"
    - "Pathfinding (future) can depend on NavigationGrid without knowing Island"
  artifacts:
    - path: "src/main/java/com/mojang/tower/navigation/NavigationGrid.java"
      provides: "Interface for walkability and collision queries"
      exports: ["NavigationGrid"]
    - path: "src/main/java/com/mojang/tower/Island.java"
      provides: "NavigationGrid implementation"
      contains: "implements NavigationGrid"
    - path: "src/main/java/com/mojang/tower/movement/MovementSystem.java"
      provides: "Movement execution using NavigationGrid"
      contains: "NavigationGrid"
  key_links:
    - from: "MovementSystem.java"
      to: "NavigationGrid"
      via: "field type and setNavigationGrid method"
      pattern: "private NavigationGrid"
    - from: "Island.java"
      to: "NavigationGrid"
      via: "implements clause"
      pattern: "implements NavigationGrid"
    - from: "TowerComponent.java"
      to: "MovementSystem.setNavigationGrid"
      via: "wiring call"
      pattern: "setNavigationGrid\\(island\\)"
---

<objective>
Create NavigationGrid interface and have Island implement it, then update MovementSystem to depend on the interface instead of concrete Island.

Purpose: Establish clean abstraction for world queries, enabling future pathfinding to depend on interface rather than Island implementation.
Output: NavigationGrid interface, Island implementing it, MovementSystem using interface type.
</objective>

<execution_context>
@/home/docinhos/.claude/get-shit-done/workflows/execute-plan.md
@/home/docinhos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-navigation-sealed-hierarchies/04-RESEARCH.md
@src/main/java/com/mojang/tower/Island.java
@src/main/java/com/mojang/tower/movement/MovementSystem.java
@src/main/java/com/mojang/tower/TowerComponent.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create NavigationGrid interface</name>
  <files>src/main/java/com/mojang/tower/navigation/NavigationGrid.java</files>
  <action>
Create new package `com.mojang.tower.navigation` and NavigationGrid interface with exactly 3 methods matching Island's existing signatures:

```java
package com.mojang.tower.navigation;

import com.mojang.tower.Entity;
import com.mojang.tower.TargetFilter;

/**
 * Interface for world navigation queries.
 * Abstracts walkability and collision detection for movement and pathfinding systems.
 */
public interface NavigationGrid {
    /**
     * Check if a position is on valid ground (within bounds, on solid terrain).
     */
    boolean isOnGround(double x, double y);

    /**
     * Check if a circular area is free for movement.
     * @param exclude entity to exclude from collision check (null to check all)
     */
    boolean isFree(double x, double y, double radius, Entity exclude);

    /**
     * Find entity at a position matching an optional filter.
     * @param filter entity filter (null accepts all entities)
     * @param exclude entity to exclude from search (null to search all)
     * @return closest matching entity, or null if none found
     */
    Entity getEntityAt(double x, double y, double radius, TargetFilter filter, Entity exclude);
}
```

Keep interface focused on what MovementSystem needs. Do NOT add convenience overloads (those stay in Island).
  </action>
  <verify>File exists and compiles: `mvn compile -q`</verify>
  <done>NavigationGrid interface exists with 3 methods matching Island's API</done>
</task>

<task type="auto">
  <name>Task 2: Island implements NavigationGrid + MovementSystem uses interface</name>
  <files>
    src/main/java/com/mojang/tower/Island.java
    src/main/java/com/mojang/tower/movement/MovementSystem.java
    src/main/java/com/mojang/tower/TowerComponent.java
    src/main/java/com/mojang/tower/service/ServiceLocator.java
  </files>
  <action>
**Island.java:**
- Add import: `import com.mojang.tower.navigation.NavigationGrid;`
- Change class declaration to: `public class Island implements NavigationGrid`
- No method changes needed - existing methods already match interface signatures

**MovementSystem.java:**
- Change import from `import com.mojang.tower.Island;` to `import com.mojang.tower.navigation.NavigationGrid;`
- Change field: `private Island island;` to `private NavigationGrid grid;`
- Rename method: `setIsland(Island island)` to `setNavigationGrid(NavigationGrid grid)`
- Update method body to use `this.grid = grid;`
- Update `move()` method to use `grid` instead of `island`

**TowerComponent.java:**
- Change line `movementSystem.setIsland(island);` to `movementSystem.setNavigationGrid(island);`

**ServiceLocator.java (optional naming update):**
- No changes required - MovementSystem type is unchanged, only its internal dependency changed
  </action>
  <verify>
- Compile: `mvn compile -q`
- Run golden master test: `mvn test -Dtest=GoldenMasterTest -q`
  </verify>
  <done>Island implements NavigationGrid, MovementSystem depends on interface, golden master passes</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. `mvn compile -q` succeeds
2. `mvn test -q` passes (all tests including golden master)
3. NavigationGrid interface has 3 methods (isOnGround, isFree, getEntityAt)
4. Island class declaration includes "implements NavigationGrid"
5. MovementSystem has NavigationGrid field, not Island field
6. TowerComponent calls setNavigationGrid, not setIsland
</verification>

<success_criteria>
- NavigationGrid interface exists in navigation package
- Island implements NavigationGrid
- MovementSystem depends on NavigationGrid (interface), not Island (concrete)
- All tests pass (behavior unchanged)
</success_criteria>

<output>
After completion, create `.planning/phases/04-navigation-sealed-hierarchies/04-01-SUMMARY.md`
</output>
