---
phase: 04-navigation-sealed-hierarchies
plan: 03
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/main/java/com/mojang/tower/Job.java
autonomous: true

must_haves:
  truths:
    - "Job class is sealed with explicit permits clause"
    - "All 6 nested Job subclasses are marked final"
    - "Compiler enforces exhaustive pattern matching on Job subtypes"
  artifacts:
    - path: "src/main/java/com/mojang/tower/Job.java"
      provides: "Sealed base class for all job types"
      contains: "sealed class Job"
  key_links:
    - from: "Job.java permits"
      to: "6 nested subclasses"
      via: "permits clause with fully qualified nested names"
      pattern: "permits Job.Goto, Job.GotoAndConvert, Job.Hunt, Job.Build, Job.Plant, Job.Gather"
---

<objective>
Seal the Job class with explicit permits clause and mark all nested subclasses as final.

Purpose: Enable exhaustive pattern matching on Job subtypes and prevent unauthorized extensions.
Output: Sealed Job class with 6 final nested subclasses.
</objective>

<execution_context>
@/home/docinhos/.claude/get-shit-done/workflows/execute-plan.md
@/home/docinhos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-navigation-sealed-hierarchies/04-RESEARCH.md
@src/main/java/com/mojang/tower/Job.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Seal Job class with permits clause</name>
  <files>src/main/java/com/mojang/tower/Job.java</files>
  <action>
Modify Job class declaration from:
```java
public class Job
```

To:
```java
public sealed class Job
    permits Job.Goto, Job.GotoAndConvert, Job.Hunt, Job.Build, Job.Plant, Job.Gather
```

The permits clause lists all 6 nested subclasses using fully qualified names (Job.Subclass).

**Key insight from research:** Keep Job as a sealed CLASS, not interface. The nested subclasses share significant mutable state (`peon`, `island`, `target`, `boreTime`, `bonusRadius`) from the parent class. Converting to interface would require each implementation to duplicate these fields.

Do NOT change Job to an interface. Only add the `sealed` modifier and `permits` clause.
  </action>
  <verify>Compile will fail until subclasses are marked final - expected</verify>
  <done>Job class has sealed modifier and permits clause listing all 6 nested subclasses</done>
</task>

<task type="auto">
  <name>Task 2: Mark all 6 nested Job subclasses as final</name>
  <files>src/main/java/com/mojang/tower/Job.java</files>
  <action>
In Job.java, add `final` modifier to each of the 6 nested static class declarations:

**Goto:** `public static class Goto extends Job` -> `public static final class Goto extends Job`
**GotoAndConvert:** `public static class GotoAndConvert extends Job` -> `public static final class GotoAndConvert extends Job`
**Hunt:** `public static class Hunt extends Job` -> `public static final class Hunt extends Job`
**Build:** `public static class Build extends Job` -> `public static final class Build extends Job`
**Plant:** `public static class Plant extends Job` -> `public static final class Plant extends Job`
**Gather:** `public static class Gather extends Job` -> `public static final class Gather extends Job`

All nested subclasses use `final` (not `sealed` or `non-sealed`) because none have further subclasses.
  </action>
  <verify>
- Compile: `mvn compile -q`
- Run golden master test: `mvn test -Dtest=GoldenMasterTest -q`
  </verify>
  <done>All 6 nested Job subclasses are final, sealed hierarchy compiles, golden master passes</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. `mvn compile -q` succeeds
2. `mvn test -q` passes (all tests including golden master)
3. Job.java contains "sealed class Job" and "permits" with all 6 nested subclasses
4. All 6 nested class declarations contain "final"
5. Job remains a class (NOT converted to interface)
</verification>

<success_criteria>
- Job is sealed with explicit permits clause
- All 6 nested subclasses (Goto, GotoAndConvert, Hunt, Build, Plant, Gather) are final
- Sealed hierarchy enables exhaustive pattern matching
- Shared state (peon, island, target, etc.) preserved via class inheritance
- All tests pass (behavior unchanged)
</success_criteria>

<output>
After completion, create `.planning/phases/04-navigation-sealed-hierarchies/04-03-SUMMARY.md`
</output>
