---
phase: 04-navigation-sealed-hierarchies
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/main/java/com/mojang/tower/Entity.java
  - src/main/java/com/mojang/tower/FarmPlot.java
  - src/main/java/com/mojang/tower/House.java
  - src/main/java/com/mojang/tower/InfoPuff.java
  - src/main/java/com/mojang/tower/Monster.java
  - src/main/java/com/mojang/tower/Peon.java
  - src/main/java/com/mojang/tower/Puff.java
  - src/main/java/com/mojang/tower/Rock.java
  - src/main/java/com/mojang/tower/Tower.java
  - src/main/java/com/mojang/tower/Tree.java
autonomous: true

must_haves:
  truths:
    - "Entity class is sealed with explicit permits clause"
    - "All 9 Entity subclasses are marked final"
    - "Compiler enforces exhaustive pattern matching on Entity subtypes"
  artifacts:
    - path: "src/main/java/com/mojang/tower/Entity.java"
      provides: "Sealed base class for all game entities"
      contains: "sealed class Entity"
    - path: "src/main/java/com/mojang/tower/Monster.java"
      provides: "Final entity subclass"
      contains: "final class Monster"
    - path: "src/main/java/com/mojang/tower/Peon.java"
      provides: "Final entity subclass"
      contains: "final class Peon"
  key_links:
    - from: "Entity.java"
      to: "9 subclasses"
      via: "permits clause"
      pattern: "permits FarmPlot, House, InfoPuff, Monster, Peon, Puff, Rock, Tower, Tree"
---

<objective>
Seal the Entity class hierarchy with explicit permits clause and mark all subclasses as final.

Purpose: Enable exhaustive pattern matching on Entity subtypes and prevent unauthorized extensions.
Output: Sealed Entity class with 9 final subclasses.
</objective>

<execution_context>
@/home/docinhos/.claude/get-shit-done/workflows/execute-plan.md
@/home/docinhos/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-navigation-sealed-hierarchies/04-RESEARCH.md
@src/main/java/com/mojang/tower/Entity.java
</context>

<tasks>

<task type="auto">
  <name>Task 1: Seal Entity class with permits clause</name>
  <files>src/main/java/com/mojang/tower/Entity.java</files>
  <action>
Modify Entity class declaration from:
```java
public class Entity implements Comparable<Entity>
```

To:
```java
public sealed class Entity implements Comparable<Entity>
    permits FarmPlot, House, InfoPuff, Monster, Peon, Puff, Rock, Tower, Tree
```

The permits clause must list ALL 9 direct subclasses in alphabetical order. All subclasses are in the same package (com.mojang.tower), so this will compile.

Do NOT change any other code in Entity.java.
  </action>
  <verify>Compile will fail until subclasses are marked final - expected</verify>
  <done>Entity class has sealed modifier and permits clause listing all 9 subclasses</done>
</task>

<task type="auto">
  <name>Task 2: Mark all 9 Entity subclasses as final</name>
  <files>
    src/main/java/com/mojang/tower/FarmPlot.java
    src/main/java/com/mojang/tower/House.java
    src/main/java/com/mojang/tower/InfoPuff.java
    src/main/java/com/mojang/tower/Monster.java
    src/main/java/com/mojang/tower/Peon.java
    src/main/java/com/mojang/tower/Puff.java
    src/main/java/com/mojang/tower/Rock.java
    src/main/java/com/mojang/tower/Tower.java
    src/main/java/com/mojang/tower/Tree.java
  </files>
  <action>
For each of the 9 subclass files, add `final` modifier to class declaration:

**FarmPlot.java:** `public class FarmPlot` -> `public final class FarmPlot`
**House.java:** `public class House` -> `public final class House`
**InfoPuff.java:** `public class InfoPuff` -> `public final class InfoPuff`
**Monster.java:** `public class Monster` -> `public final class Monster`
**Peon.java:** `public class Peon` -> `public final class Peon`
**Puff.java:** `public class Puff` -> `public final class Puff`
**Rock.java:** `public class Rock` -> `public final class Rock`
**Tower.java:** `public class Tower` -> `public final class Tower`
**Tree.java:** `public class Tree` -> `public final class Tree`

All subclasses use `final` (not `sealed` or `non-sealed`) because none have further subclasses.
  </action>
  <verify>
- Compile: `mvn compile -q`
- Run golden master test: `mvn test -Dtest=GoldenMasterTest -q`
  </verify>
  <done>All 9 Entity subclasses are final, sealed hierarchy compiles, golden master passes</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. `mvn compile -q` succeeds
2. `mvn test -q` passes (all tests including golden master)
3. Entity.java contains "sealed class Entity" and "permits" with all 9 subclasses
4. All 9 subclass files contain "final class"
5. No subclass is marked `sealed` or `non-sealed` (all are leaf classes)
</verification>

<success_criteria>
- Entity is sealed with explicit permits clause
- All 9 subclasses (FarmPlot, House, InfoPuff, Monster, Peon, Puff, Rock, Tower, Tree) are final
- Sealed hierarchy enables exhaustive pattern matching
- All tests pass (behavior unchanged)
</success_criteria>

<output>
After completion, create `.planning/phases/04-navigation-sealed-hierarchies/04-02-SUMMARY.md`
</output>
